import { __esDecorate, __runInitializers } from "tslib";
import { errorLoggingDecorator } from "../logger/errorLoggingDecorator";
import { getLogger } from "../logger/logger";
import { LensPerformanceMeasurement } from "./LensPerformanceMeasurement";
const logger = getLogger("RenderingMetrics");
export let LensPerformanceMetrics = (() => {
    var _a;
    let _instanceExtraInitializers = [];
    let _beginMeasurement_decorators;
    return _a = class LensPerformanceMetrics {
            constructor(frameEvents) {
                this.measurementInstances = (__runInitializers(this, _instanceExtraInitializers), void 0);
                this.measurementInstances = new Set();
                this.subscription = frameEvents.subscribe({
                    next: (frameEvent) => {
                        try {
                            for (const measurement of this.measurementInstances.values()) {
                                measurement.update(frameEvent.processingTimeMs);
                            }
                        }
                        catch (error) {
                            logger.error(error);
                        }
                    },
                    error: (error) => {
                        logger.error(error);
                    },
                });
            }
            beginMeasurement() {
                return new LensPerformanceMeasurement(this.measurementInstances);
            }
            destroy() {
                this.subscription.unsubscribe();
            }
        },
        (() => {
            _beginMeasurement_decorators = [errorLoggingDecorator(logger)];
            __esDecorate(_a, null, _beginMeasurement_decorators, { kind: "method", name: "beginMeasurement", static: false, private: false, access: { has: obj => "beginMeasurement" in obj, get: obj => obj.beginMeasurement } }, null, _instanceExtraInitializers);
        })(),
        _a;
})();
//# sourceMappingURL=LensPerformanceMetrics.js.map